<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Make a Booking · Tutoring Services</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --brand: #0f2743;
      --brand-600: #143354;
      --soft: #f6f9ff;
    }
    body { background: var(--soft); color: #0f172a; }
    .navbar { background: linear-gradient(90deg, var(--brand), var(--brand-600)); }
    .navbar .navbar-brand, .navbar .nav-link { color: #fff; }
    .card { border-radius: 1rem; }
    .form-label { font-weight: 600; }
    .summary-card { position: sticky; top: 1rem; }
    .price-lg { font-size: 2rem; font-weight: 800; }
    .btn-primary { background: var(--brand); border-color: var(--brand); }
    .btn-primary:hover { background: var(--brand-600); border-color: var(--brand-600); }
    .brand-chip { background: #0f27431a; color: var(--brand); font-weight: 600; }
    .confirmation-message { display: none; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-md mb-5 shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="#">TutorBook</a>
    </div>
  </nav>

  <div class="container pb-5">
    <div class="row g-4">
      <!-- FORM -->
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body p-4 p-md-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <h1 class="h3 mb-0">Make a Booking</h1>
                <div class="text-muted">Secure lessons in a few clicks.</div>
              </div>
            </div>
            <hr class="my-3" />

            <form id="bookingForm" novalidate>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="gradeSelect" class="form-label">Grade band</label>
                  <select class="form-select" id="gradeSelect" name="grade" required>
                    <option value="" selected disabled>Select</option>
                    <option value="Grade 1-6">Grade 1–6</option>
                    <option value="Grade 7-12">Grade 7–12</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label for="subjectSelect" class="form-label">Subject</label>
                  <select class="form-select" id="subjectSelect" name="subject" required>
                    <option value="" selected disabled>Select</option>
                    <option>Geography</option>
                    <option>Physical Sciences</option>
                    <option>Social Sciences</option>
                    <option>Natural Sciences</option>
                    <option>Life Sciences</option>
                    <option>English</option>
                    <option>Mathematics</option>
                    <option>Maths Literacy</option>
                  </select>
                </div>

                <div class="col-12">
                  <label for="lessonTypeSelect" class="form-label">Lesson type</label>
                  <select class="form-select" id="lessonTypeSelect" name="lessonType" required>
                    <option value="" selected disabled>Select</option>
                    <option value="Face-to-face - One on one">Face-to-face — One on one</option>
                    <option value="Face-to-face - 2 learners package">Face-to-face — 2 learners package</option>
                    <option value="Face-to-face - 3 or more learners package">Face-to-face — 3+ learners package</option>
                    <option value="Online - One on one">Online — One on one</option>
                    <option value="Online - 2 learners package">Online — 2 learners package</option>
                    <option value="Online - 3 or more learners package">Online — 3+ learners package</option>
                  </select>
                  <div class="form-text">Group packages are billed per person (pp) at the shown hourly rate.</div>
                </div>

                <div class="col-md-6">
                  <label for="hoursInput" class="form-label">Hours per session</label>
                  <input type="number" min="0.5" max="8" step="0.5" class="form-control" id="hoursInput" name="hours" placeholder="e.g. 1.5" required />
                  <div class="invalid-feedback">Enter between 0.5 and 8 hours.</div>
                </div>

                <div class="col-md-6">
                  <label for="durationSelect" class="form-label">Upfront commitment</label>
                  <select class="form-select" id="durationSelect" name="duration" required>
                    <option value="" selected disabled>Select</option>
                    <option value="1">1 month (no discount)</option>
                    <option value="3">3 months (5% off)</option>
                    <option value="6">6 months (8% off)</option>
                    <option value="9">9 months (12% off)</option>
                    <option value="12">12 months (15% off)</option>
                  </select>
                </div>
              </div>

              <hr class="my-4" />

              <!-- Customer details -->
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label" for="firstName">First name</label>
                  <input id="firstName" name="name_first" type="text" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="lastName">Last name</label>
                  <input id="lastName" name="name_last" type="text" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="email">Email</label>
                  <input id="email" name="email_address" type="email" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="phone">Contact number</label>
                  <input id="phone" name="cell_number" type="tel" class="form-control" placeholder="e.g. 082 123 4567" required />
                </div>
              </div>

              <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" id="terms" required>
                <label class="form-check-label" for="terms">I accept the scheduling and cancellation policy.</label>
              </div>

              <div class="alert alert-success confirmation-message mt-3" id="confirmationMessage">
                <strong>Booking Confirmed!</strong> We've received your booking details and will contact you soon to finalize the schedule.
              </div>

              <div class="d-grid gap-2 d-sm-flex mt-4">
                <button type="submit" class="btn btn-primary btn-lg px-4">Book now</button>
                <a href="index.html" class="btn btn-outline-secondary btn-lg px-4">Cancel</a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- SUMMARY -->
      <div class="col-lg-5">
        <div class="card shadow-sm summary-card">
          <div class="card-body p-4">
            <h2 class="h5 mb-3">Booking Summary</h2>

            <div class="d-flex justify-content-between"><span>Grade band</span><span class="fw-semibold" id="sumGrade">—</span></div>
            <div class="d-flex justify-content-between"><span>Subject</span><span class="fw-semibold" id="sumSubject">—</span></div>
            <div class="d-flex justify-content-between"><span>Lesson type</span><span class="fw-semibold" id="sumLesson">—</span></div>
            <div class="d-flex justify-content-between"><span>Hours per session</span><span class="fw-semibold" id="sumHours">—</span></div>
            <div class="d-flex justify-content-between"><span>Upfront months</span><span class="fw-semibold" id="sumMonths">—</span></div>
            <hr>
            <div class="d-flex justify-content-between"><span>Hourly rate</span><span id="sumHourly">R0</span></div>
            <div class="d-flex justify-content-between"><span>Discount</span><span id="sumDiscount">0%</span></div>
            <div class="d-flex justify-content-between"><span>Discounted hourly</span><span id="sumHourlyDisc">R0</span></div>
            <div class="d-flex justify-content-between"><span>Group size</span><span id="sumGroup">—</span></div>
            <div class="d-flex justify-content-between"><span>Estimated total</span><span class="price-lg" id="sumTotal">R0.00</span></div>

            <div class="alert alert-info mt-3 mb-0">
              <div class="small">Totals are <strong>per person</strong> for group packages. Final quotes may vary based on schedule and location.</div>
            </div>
          </div>
        </div>
      </div>
      <!-- /SUMMARY -->
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const SHEETS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxQYsXtiHtHQRhBQSn4FzH9hpF1geTdzX6XhKT1nCkH5XEcpilnFCZeRZtSqYJkUOU/exec"; // e.g. https://script.google.com/macros/s/AKfycbx.../exec

    // Rates
    const basePrices = {
      "Grade 7-12": {
        "Face-to-face - One on one": 200,
        "Face-to-face - 2 learners package": 150,
        "Face-to-face - 3 or more learners package": 120,
        "Online - One on one": 170,
        "Online - 2 learners package": 150,
        "Online - 3 or more learners package": 120,
      },
      "Grade 1-6": {
        "Face-to-face - One on one": 170,
        "Face-to-face - 2 learners package": 130,
        "Face-to-face - 3 or more learners package": 100,
        "Online - One on one": 150,
        "Online - 2 learners package": 130,
        "Online - 3 or more learners package": 100,
      }
    };

    const learnersPerPackage = {
      "Face-to-face - One on one": 1,
      "Face-to-face - 2 learners package": 2,
      "Face-to-face - 3 or more learners package enemmän3": 3,
      "Online - One on one": 1,
      "Online - 2 learners package": 2,
      "Online - 3 or more learners package": 3,
    };

    const discounts = { 1: 0, 3: 0.05, 6: 0.08, 9: 0.12, 12: 0.15 };

    // ===== Helpers =====
    const el = id => document.getElementById(id);
    const fmt = n => 'R' + Number(n).toFixed(2);

    const form = el('bookingForm');
    const grade = el('gradeSelect');
    const subject = el('subjectSelect');
    const lesson = el('lessonTypeSelect');
    const months = el('durationSelect');
    const hours = el('hoursInput');

    const sumGrade = el('sumGrade');
    const sumSubject = el('sumSubject');
    const sumLesson = el('sumLesson');
    const sumHours = el('sumHours');
    const sumMonths = el('sumMonths');
    const sumHourly = el('sumHourly');
    const sumDiscount = el('sumDiscount');
    const sumHourlyDisc = el('sumHourlyDisc');
    const sumGroup = el('sumGroup');
    const sumTotal = el('sumTotal');
    const confirmationMessage = el('confirmationMessage');

    function recalc() {
      const g = grade.value;
      const l = lesson.value;
      const m = parseInt(months.value || 0);
      const h = parseFloat(hours.value || 0);

      const base = (g && l) ? basePrices[g][l] : 0;
      const group = learnersPerPackage[l] || 0;
      const disc = discounts[m] || 0;
      const hourlyDisc = base * (1 - disc);

      const totalPP = (base && h && m) ? (hourlyDisc * h * m) : 0;

      sumGrade.textContent = g || '—';
      sumSubject.textContent = subject.value || '—';
      sumLesson.textContent = l || '—';
      sumHours.textContent = h ? h : '—';
      sumMonths.textContent = m ? m : '—';
      sumHourly.textContent = base ? fmt(base) + (group > 1 ? ' pp' : '') : 'R0';
      sumDiscount.textContent = Math.round(disc * 100) + '%';
      sumHourlyDisc.textContent = base ? fmt(hourlyDisc) + (group > 1 ? ' pp' : '') : 'R0';
      sumGroup.textContent = group || '—';
      sumTotal.textContent = fmt(totalPP) + (group > 1 ? ' pp' : '');
    }

    [grade, subject, lesson, months, hours].forEach(x => x.addEventListener('input', recalc));
    recalc();

    // Form submission handling
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      recalc();

      if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
      }

      // Build payload for Google Sheets
      const payload = {
        firstName: el('firstName').value,
        lastName: el('lastName').value,
        email: el('email').value,
        phone: el('phone').value,
        grade: grade.value,
        subject: subject.value,
        lessonType: lesson.value,
        hours: parseFloat(hours.value || 0),
        months: parseInt(months.value || 0),
        groupSize: learnersPerPackage[lesson.value] || 0,
        hourly: (grade.value && lesson.value) ? basePrices[grade.value][lesson.value] : 0,
        discountPct: discounts[months.value] || 0,
        hourlyDiscounted: (grade.value && lesson.value) ? basePrices[grade.value][lesson.value] * (1 - (discounts[months.value] || 0)) : 0,
        total: parseFloat((sumTotal.textContent.match(/[0-9.]+/) || ['0'])[0]) // Extract total from display
      };

      try {
        if (SHEETS_ENDPOINT) {
          const response = await fetch(SHEETS_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
            mode: 'cors'
          });

          if (response.ok) {
            confirmationMessage.style.display = 'block';
            form.reset();
            recalc();
            form.classList.remove('was-validated');
            setTimeout(() => {
              confirmationMessage.style.display = 'none';
            }, 5000); // Hide after 5 seconds
          } else {
            alert('Booking submission failed. Please try again.');
          }
        } else {
          console.warn('SHEETS_ENDPOINT is not set.');
          alert('Booking submission failed: No endpoint configured.');
        }
      } catch (err) {
        console.warn('Booking submission failed:', err);
        alert('An error occurred. Please try again.');
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>